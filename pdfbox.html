<HTML>
<head>
    <!--This is important! needs to be UTF-8 to be compatible with adobe acceptable text-->
    <meta charset="UTF-8">
<title>
    Bullets Viewer
</title>
<style type="text/css">
#bulletTextArea{
    margin: 0px;
    height: 500px;
    /*width: 202.321mm;*/
    width:765.5px;
    white-space: pre-wrap;
    text-indent: 0px;
    overflow: hidden;
    border: none;
    padding-left: 0px;
    resize: vertical;
    /*word-break: break-all;*/
    /*text-rendering: optimizeSpeed;*/
}
.border{
    border: solid black 1px;
    display: inline-block;
}

#processedBullets{
    display:inline-block;
    vertical-align:top;
}
.bullets{
    font-family: "Times New Roman";
    font-size: 12pt;
    white-space:pre;
    display:inline;
}
.bulletContainer{
    width: 765.5px;
}
</style>
<script type="text/javascript">
updateWidth = function(){
        newWidth = document.getElementById("bulletTextAreaWidth").value + 'mm';
        //document.getElementById("bulletTextArea").style.width = newWidth;
        //document.getElementById("processedBulletsBorder").style.width = document.getElementById("bulletsBorder").style.width;
        //console.log('value changed: ' + document.getElementById("bulletTextArea").style.width + ' ' + document.getElementById("bulletTextArea").clientWidth + 'px');
    }
updateProcessedBullets = function(){
    var rawBulletStr = document.getElementById("bulletTextArea").value;
    var rawBullets = rawBulletStr.split('\n');
    var processedBulletsDiv = document.getElementById('processedBulletsBorder');
    processedBulletsDiv.innerHTML = ''; //clear out 
    for (bullet of rawBullets){
        bullet = bullet.trim();
        //console.log(bullet);
        if(! bullet){continue;}
        //create container for bullet
        var divNode = document.createElement("div");
        var spanNode = document.createElement("span");
        spanNode.className = "bullets";
        divNode.className = "bulletContainer";
        //202.489
        //765.4px
        // add bullet to container, add container to document
        spanNode.innerText = bullet;
        divNode.appendChild(spanNode);
        processedBulletsDiv.appendChild(divNode);
        optimizeSpacings(spanNode)
        //words = tokenizeSentence(bullet);



    }
}
function tokenizeSentence(sentence){
    words = sentence.split(/[\s]+/);
    //console.log(words);
    return words;
}

String.prototype.hashCode = function() {
  var hash = 0, i, chr;
  if (this.length === 0) return hash;
  for (i = 0; i < this.length; i++) {
    chr   = this.charCodeAt(i);
    hash  = ((hash << 5) - hash) + chr;
    hash |= 0; // Convert to 32bit integer
  }
  return hash;
};

function getRandomIntOld(seed, max) {
  return Math.floor(Math.random() * Math.floor(max));
  //rand = Math.floor( Math.abs(Math.floor(((9*seed.hashCode()+5) % 100000) / 100000)) * Math.floor(max));
  //return rand;
}

function getRandomInt(seed,max){
    return Math.floor( Math.abs((Math.floor(9*seed.hashCode()+5) % 100000) / 100000) * Math.floor(max));
}

function optimizeSpacings(spanNode){

    var desiredSize = spanNode.parentNode.getBoundingClientRect().width;
    var words = tokenizeSentence(spanNode.innerText);
    
    var smallerSpace = "\u2009";
    var largerSpace = "\u2004";

    var originalSentence = words.join(' '); 
    spanNode.innerText = originalSentence;
    var originalSize = spanNode.getBoundingClientRect().width;

    var previousSentence = originalSentence;//initial instantiation of previousSentence
    var newSize = originalSize;

    error = desiredSize - originalSize;
    var addSpace = (error > 0) ? true: false;

    console.log('sentence: ' + originalSentence)
    console.log('span node size: ' + originalSize)
    console.log('div node size: ' + desiredSize)
    tol = 2;
    while(true){

        if((addSpace && (error) < tol) || (!addSpace && newSize < desiredSize)){
            console.log("Final error of " + error);
            break;
        }

        if(words.length <= 2){
            console.log("Warning: Can't replace any more spaces;\n Final error of " + error +  ": " + originalSentence);
            break;
        }
        if(addSpace){
            reSplacement = largerSpace;
        }else{
            reSplacement = smallerSpace;
        }
        //don't select the first space after the dash- that would be noticeable and look wierd.
        // also don't select the last word, don't want to add a space after that.
        iReplace = getRandomInt(words.join(''), words.length -1 -1) + 1;
        
        words.splice( 
            iReplace, 2, 
            words.slice(iReplace,iReplace+2).join(reSplacement)
        );
        console.log( (addSpace?'increased':'decreased') + ' space at index ' + iReplace + " : " + words[iReplace]);

        //make all other spaces the normal space size
        newSentence = words.join(' ');
        //check 
        spanNode.innerText = newSentence;
        newSize = spanNode.getBoundingClientRect().width;
        
        if(addSpace && newSize > desiredSize){
            
            console.log("Warning: Can't add more spaces without overflow, reverting to previous;\n Final error of " + error );
            spanNode.innerText = previousSentence;
            break;
        
        } 
        error = (desiredSize - newSize);
        console.log("error: " + error);
        previousSentence = newSentence;


    }
}
window.onload = function(e){
    updateWidth();
    updateProcessedBullets();
    document.getElementById("bulletTextAreaWidth").oninput = updateWidth;
    document.getElementById("bulletTextArea").oninput = updateProcessedBullets;
};

</script>
</head>
<body>
    <label>Form width (should not have to adjust): </label>
    <input type="number" id="bulletTextAreaWidth" name="width" min="100" max="500" step=".001" value="202.321">
    <!-- TODO: add button to clean whitespace in bullet textarea into normal bullets-->
    <br />
    <div class="border" id="bulletsBorder">
    <textarea class='bullets' id="bulletTextArea">
- Trained Navy test tm; taught h/w-in-loop procedure & mobile control box design--primed msn data cape f/jt trng pod
- 17-mbr programming test tm; delivered 9 cbt & test s/w files for 3 sys's--fortified F-16/A-10 electronic attack capes
- Instructed 53 electronic cmbt pilots on jamming concepts; brf'd sys capes & effects--enhanced CAF ops effectiveness 
- Overhauled jammer threat database; streamlined F-16/A-10 msn data production--reduced data redundancies by 60%
- Led next-gen pod s/w readiness rvw; drove 17 updates/liaised w/ctr & Prgm Ofc--averted 6-mo slip of $450M prgm
- Briefed HAF ldrshp as test SME; ID'd cape & resourcing gaps--vectored ACC foreign material exploitation enterprise
- Organized reprogramming events; directed SERENE BYTE msn data prgm exers--readied future cbt ops f/19 Wg's
- Collaborated w/Msl & Space Intel Cntr; studied & exploited adv'd digital rdrs--incr'd msl threat knowledge f/intel ops
- Coordinated 3-wk/4-org test; innovated electronic attack concept--revealed directive jamming as viable future ftr TTP
- Instructed AFSOC jammer tm; guided waveform effectiveness eval process--enabled 9-mo op test of future gnd sys
- Drove DIA EW first-look; val'd techniques, oversaw log--garnered 55% lethality reduction of emerging digital threat
- Headed urgent Op Chg Req prgm'g tm; dvlp'd, fld'd cbt s/w <72 hrs--guaranteed 100% A-10 EW coverage f/hot AOR
- Leveraged legacy exploitation events to test pod upgrade; demonstrated EW capes vs 4 threats--$70K addâ€™l data at $0
- Optimized Angry Kitten msn data; developed viable response vs 2 prolific threats--proved trng pod f/cbt mission role
- Advised APG-83 jamming vulnerability eval; vald'd next-gen EW--hardened electronic protection f/$25.6B AF assets
- Directed multisvc jammer eval; exec'd 1K RF sims/optimized effects vs 2 sys's--improved 1.3K cbt acft survivability
- Built Cbt Adv Surface-to-Air Msl Survivability s/w; gen'd resps vs 9 threats--prompted on-time $300K flt test launch  
- Spearheaded reaction to urgent HHQ reqmt; certified 8 cbt threats f/2 sys's--satisfied COMACC request 10 days early
</textarea>
</div>
<div id="processedBulletsBorder" class='border'>
</div>
</body>
</HTML>